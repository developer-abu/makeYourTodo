<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>create your to do</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
<div id="showingMassage">
    
    <p>Please use Desktop if use mobile for better view.</p>
    <p>Click <span>&times;</span> to stop this massage</p>
</div>

<div id="formContainer">
<form action="" id="formId">
<label for="name">Enter Your Name</label><input type="text" id="name">
<label for="cDate">Enter Date</label><input type="date" id="cDate">
<label for="fDate">Complete By</label><input type="date" id="fDate">
<label for="tTittle">Enter Your Task Tittle</label><input type="text" id="tTittle">
<label for="tDescription">Enter Your Task Description</label><input type="text" id="tDescription" maxlength="150">
<button id="addBTN" type="submit">Add</button>




 </form>

 <table id="table">
    <tr>
        <th>Name</th>
        <th>Current Date</th>
        <th>Work to be completed within</th>
        <th>Tittle</th>
        <th>Description</th>

        <th>Marks As Completed</th>
    </tr>
</table>

</div>
 <button id="print">Print</button>
 <button id="delete">Delete</button>
 <button id="deleteLastRow">Delete Last Task</button>

 <script>

let userName= document.getElementById("name");
let cDate= document.getElementById("cDate");
let fDate= document.getElementById("fDate");
let tTittle= document.getElementById("tTittle");
let tDescription= document.getElementById("tDescription");
let addBTN= document.getElementById("addBTN");
let table = document.getElementById("table");
let formId = document.querySelector("#formId");
let print = document.querySelector("#print");
let deleteBTN = document.getElementById("delete");
let newRow;
let row;
let showingMassage = document.getElementById("showingMassage");
let deleteLastRow = document.querySelector("#deleteLastRow");

addBTN.addEventListener("click",(e)=>{
    e.preventDefault();

    newRow= document.createElement("tr");
    if(userName.value.trim()==="" || !isNaN(userName.value.trim()) || cDate.value==="" || fDate.value==="" || tTittle.value.trim()==="" || tDescription.value.trim()==="") {
alert("Your Input is not right! Please use string in Name and do not leave any form blank");
window.location.href="main.html"
    }else{
    newRow.innerHTML=`<td>${userName.value.toUpperCase()}</td>
    <td>${cDate.value}</td>
    <td>${fDate.value}</td>
    <td>${tTittle.value}</td>
    <td>${tDescription.value}</td>
   
 <td><input type="checkbox"></td>`
    table.appendChild(newRow)

let task={
    userName: userName.value.toUpperCase(),
    cDate: cDate.value,
    fDate: fDate.value,
    tTittle: tTittle.value,
    tDescription: tDescription.value,
    completed: false 

}

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
tasks.push(task);
localStorage.setItem("tasks", JSON.stringify(tasks));
formId.reset();



    }
})


print.addEventListener("click", ()=>{
    window.print();
})


window.addEventListener("DOMContentLoaded", () => {

    let savedTasks = JSON.parse(localStorage.getItem("tasks")) || [];

    savedTasks.forEach(task => {

 row = document.createElement("tr")

        row.innerHTML = `
        <td>${task.userName}</td>
        <td>${task.cDate}</td>
        <td>${task.fDate}</td>
        <td>${task.tTittle}</td>
        <td>${task.tDescription}</td>
        <td><input type="checkbox" ${task.completed ? "checked" : ""}></td>`;

        table.appendChild(row);

    });

});


table.addEventListener("change", (e) => {

    if (e.target.type === "checkbox") {


        let row = e.target.closest("tr");
        let index = row.rowIndex - 1;

        let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

        tasks[index].completed = e.target.checked;

        localStorage.setItem("tasks", JSON.stringify(tasks));
    
    }

});



showingMassage.addEventListener("click", ()=>{
    showingMassage.remove()
})
deleteLastRow.addEventListener("click", ()=>{
    let tableRow= table.getElementsByTagName("tr")

    if(tableRow.length===1){
alert("Header Row Can not be Deleted");
return
    } {
        table.deleteRow(tableRow.length-1)
  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

    tasks.pop();   // array এর last item remove

    localStorage.setItem("tasks", JSON.stringify(tasks));
    }
})


deleteBTN.addEventListener("click",()=>{

  localStorage.removeItem("tasks");
 table.innerHTML = `
    <tr>
        <th>Name</th>
        <th>Current Date</th>
        <th>Work to be completed within</th>
        <th>Tittle</th>
        <th>Description</th>
        <th>Marks As Completed</th>
    </tr>
  `;

})
</script>
</body>
</html>